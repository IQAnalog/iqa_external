<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>IQA F1000 SDK: Chip Initialization</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">IQA F1000 SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('initialization.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Chip Initialization </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="init"></a>
Initialization  Overview</h1>
<p>This section discusses what the procedures are to initialize the device for communication and control.<br />
 <br />
</p><ul>
<li>Procedures and steps to initialize<br />
</li>
<li>Analog initialization<br />
</li>
<li>Firmware download<br />
</li>
<li>JESD204B / Serdes initialization<br />
</li>
</ul>
<p>This section describes the procedures and API required to bring up IQ-Analog's F1000 chip.</p>
<h2><a class="anchor" id="power_rails"></a>
STEP 1 : Turn On Power Rails in the System Board</h2>
<p>On the System board , turn on power rails to the chip</p>
<p>For IQ-Analog's F1000 EVM, the following power rails need to be configured to properly supply voltages to F1000.</p>
<p>pvdd: Range is 1.63 to 1.95V<br />
 dvdd: Range is 0.63 to 0.95V<br />
 avdd: Range is 1.10 to 1.40V<br />
 avnn: -0.8V ON<br />
 svdd: Range is 0.63 to 0.95V<br />
 svddh: Range is 1.03, 1.35V<br />
</p>
<h2><a class="anchor" id="config_rfs"></a>
STEP 2: Configure RF synthesizer</h2>
<p>If RF synthesizer is utilized, it should be configured to the desired frequency.</p>
<h2><a class="anchor" id="chip_id"></a>
STEP 3 (Optional) : Read Chip ID</h2>
<p>If desired, call read chip id API to verify that the chip is up and running.</p>
<p><a class="el" href="iqa__f1000__chip_8h.html#a304231fde4765d7508c261eb8510dec9" title="This API retrieves the Chip ID from the given F1000 hardware. ">iqa_read_chip_id(int f1000_id, int ep_id, uint32_t * chip_id)</a></p>
<h2><a class="anchor" id="init_Analog"></a>
STEP 4: Initialize F1000 Analog Block</h2>
<p>In order to initialize the Analog Block, the iqa_init_analog api needs to be called. Click on the link to find more details about the API call. This function call configures the analog DLL(s), voltage references, etc. and enables the specified ADCs and DAC(s).</p>
<p>Please note that in F1000 Rev A, for DAC "wakeup", a special callback construct is required for hardware abstraction to perform tasks for controlling external voltages, such as disabling the AVnn, enableing AVNn switch, setting external AVdd voltage level, etc.</p>
<p><a class="el" href="iqa__f1000__chip_8h.html#a80c039f75da5c438d9c66e44dde28a43" title="This API initializes the Analog Block which includes the ADC and DAC. ">iqa_init_analog(int f1000_id, int ep_id, int adc_id, int dac_id,uint64_t fclk, const cb_dac_t * cb)</a></p>
<h2><a class="anchor" id="fw_download"></a>
STEP 5: Download firmware into RISC-V</h2>
<p>In order to download firmware into the RISC-V embedded controller, the controller needs to be in freeze mode prior to the download. The RISC-V firmware is provided in binary format in the following location: </p><pre class="fragment"> {release_directory}/binaries/riscv*.ald
</pre><p>After the download completes, the controller will need to be put back in the unfreeze mode so the firmware exeuction will start running. Below IQA API should be used to accomplish the task:</p>
<p><a class="el" href="iqa__ec__freeze_8c.html#aba417ff3d8045345e2ae560f40867f5d" title="This API freezes the firmware in IQA RISC-V embedded controller. ">iqa_ec_freeze(int f1000_id, int ep_bitmap)</a></p>
<p><a class="el" href="iqa__ec__load__firmware_8c.html#a61bb6adf496bab10bd53c60c388326c9" title="Download RISC-V firmware to the F1000 Element Processor(s). ">iqa_ec_load_firmware(int f1000_id, int ep_bitmap, char * buf, uint32_t size, iqa_fw_download_state_t *pState)</a></p>
<p><a class="el" href="iqa__ec__unfreeze_8c.html#abf7df7260d3b17d8b35b8ee0c55319ae" title="This API unfreezes the firmware in IQA RISC-V embedded controller. ">iqa_ec_unfreeze(int f1000_id, int ep_bitmap)</a></p>
<p>Once the firmware is download the API int <a class="el" href="iqa__ec__ping_8c.html#a1a568c92ec71387c4e776bbaef68e184" title="This API pings RISC-V embedded controller to check if it&#39;s functional. ">iqa_ec_ping(int f1000_id, int ep_id)</a> could be used to check if the RISC is alive and firmware is running.</p>
<h2><a class="anchor" id="merlin_firmware"></a>
STEP 6 : Download firmware into Merlin</h2>
<p>The firmware to be downloaded into Merlin should be in IQ-Analog's ALD file format. This binary file is a combination of varous firmware files for RX lanes 0 to 7, TX lanes 0 to 7 as well as for OOB. Use the following API to load the firmware to all RX, TX and OOB processors.</p>
<p><a class="el" href="iqa__merlin__load__firmware_8c.html#a04b9544bdf4d9f2a2eca5d00558ad290" title="This API Loads the Merlin Firmware in ALD format. ">iqa_merlin_load_firmware(int f1000_id, int ep_bitmap, char * buf, uint32_t size, int standalone)</a></p>
<p>A canned TX frame format Merlin firmware ALD file which sends a pre-determined fixed pattern has been provided, along with a README file describing the expected pattern. The ALD file is provided at the following location: </p><pre class="fragment"> {release_directory}/binaries/tx_canned.ald
</pre><h2><a class="anchor" id="serdesInit"></a>
STEP 7: JESD-204B Initilization</h2>
<p>Initialzing the JESD-204B consists of two steps, first initializing the Serdes PHY and then initializing the link layer. The following are the API calls for such initialization:</p>
<p><a class="el" href="iqa__serdes__init_8c.html#a8e3c8dd504065cfbfd511c8cc2af7e2b" title="Initializes the SERDES Block. ">iqa_serdes_init()</a>;<br />
</p>
<p><a class="el" href="iqa__jesd__tx__sw__reset_8c.html#ab11f8febf0b9ecbcb4354c7b3a568fbe" title="This API performs a sofware reset on the F1000 JESD TX. ">iqa_jesd_tx_sw_reset()</a>;<br />
</p>
<p><a class="el" href="iqa__jesd__tx__lane__enable_8c.html#a467fdc8958a814297699000d2aa13668" title="This API enables JESD204b TX lanes in the F1000 EP. ">iqa_jesd_tx_lane_enable()</a>;<br />
</p>
<p><a class="el" href="iqa__jesd__rx__sw__reset_8c.html#a29eac4b2f10bb0de79b5e376963dadc3" title="This API performs a sofware reset on the F1000 JESD RX. ">iqa_jesd_rx_sw_reset()</a>;<br />
</p>
<p><a class="el" href="iqa__jesd__rx__lane__enable_8c.html#a86c90c9ae42722a879e38c15fdabc099" title="This API enables JESD204b RX lanes in the F1000 EP. ">iqa_jesd_rx_lane_enable()</a>;<br />
</p>
<p>The JESD-204B Link Layer status can be queried using the API calls:</p>
<p><a class="el" href="iqa__jesd__tx__get__lane__status_8c.html#a9936ca6009cb030299d947643a21ff1b" title="This API gets the status of the specified JESD204b TX lane. ">iqa_jesd_tx_get_lane_status()</a>;</p>
<p><a class="el" href="iqa__jesd__rx__get__lane__status_8c.html#ae51b0013b6759a2237c8686b767f18ed" title="This API gets the status of the specified JESD204b RX lane. ">iqa_jesd_rx_get_lane_status()</a>; </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr class="footer"/><address class="footer">
IQ-Analog Corporation</address>
</body>
</html>
